<h1>{{title}}</h1>
<div id='lightning'/>

<!-- JS import from auto-generated snippet -->
<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<!-- Lightning out import -->
<script src="https://baxtercreditunion--sldevchat2.lightning.force.com/lightning/lightning.out.js"></script>

<!-- Auto-generated CSS -->

<style type='text/css'>
	.embeddedServiceHelpButton .helpButton .uiButton {
		background-color: #148dc3;
		font-family: "Arial", sans-serif;
	}
	.embeddedServiceHelpButton .helpButton .uiButton:focus {
		outline: 1px solid #148dc3;
	}
</style>

<script type='text/javascript'>

	// Lightning out code
	$Lightning.use("embeddedService:sidebarApp",
		function() {

			$Lightning.createComponent("c:sL_ChatOAuthRedirectHandler", {
				},
				"lightning",
				function(cmp) {
					initBot();
				}
			);
		},
		'https://sldevchat2-bcu.cs68.force.com/2020myBCUKnowledge',
		'{{authToken}}'
	);

	//
	var initESW = function(gslbBaseURL) {

		setCustomBotProperties();

		// Auto-generated code for setting properties

		embedded_svc.settings.displayHelpButton = true; //Or false
		embedded_svc.settings.language = ''; //For example, enter 'en' or 'en-US'

		//embedded_svc.settings.defaultMinimizedText = '...'; //(Defaults to Chat with an Expert)
		//embedded_svc.settings.disabledMinimizedText = '...'; //(Defaults to Agent Offline)

		//embedded_svc.settings.loadingText = ''; //(Defaults to Loading)
		//embedded_svc.settings.storageDomain = 'yourdomain.com'; //(Sets the domain for your deployment so that visitors can navigate subdomains during a chat session)

		// Settings for Chat
		//embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
		// Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
		// Returns a valid button ID.
		//};
		//embedded_svc.settings.prepopulatedPrechatFields = {}; //Sets the auto-population of pre-chat form fields
		//embedded_svc.settings.fallbackRouting = []; //An array of button IDs, user IDs, or userId_buttonId
		//embedded_svc.settings.offlineSupportMinimizedText = '...'; //(Defaults to Contact Us)

		embedded_svc.settings.enabledFeatures = ['LiveAgent'];
		embedded_svc.settings.entryFeature = 'LiveAgent';

		embedded_svc.init(
			'https://baxtercreditunion--sldevchat2.my.salesforce.com',
			'https://sldevchat2-bcu.cs68.force.com/2020myBCUKnowledge',
			gslbBaseURL,
			'00D1D00000039fl',
			'BCU_Chatbot_v2',
			{
				baseLiveAgentContentURL: 'https://c.la4-c1cs-dfw.salesforceliveagent.com/content',
				deploymentId: '5725x000000Lc3C',
				buttonId: '5731D000000Cd0H',
				baseLiveAgentURL: 'https://d.la4-c1cs-dfw.salesforceliveagent.com/chat',
				eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I1D0000004CKfUAM_1728545d62e',
				isOfflineSupportEnabled: true
			}
		);
	};

	// Function for initializing the bot
	var initBot = function() {

		if (!window.embedded_svc) {
			var s = document.createElement('script');
			s.setAttribute('src', 'https://baxtercreditunion--sldevchat2.my.salesforce.com/embeddedservice/5.0/esw.min.js');
			s.onload = function() {
			initESW(null);
			};
			document.body.appendChild(s);
		} else {
			initESW('https://service.force.com');
		}
    }

    // Function for configuring custom properties in the bot
    var setCustomBotProperties = function() {
		embedded_svc.settings.extraPrechatFormDetails = [
			{
			  "label": "Alkami GUID",
			  "displayToAgent": true,
			  "transcriptFields": ["Alkami_GUID__c"]
			}, {
			  "label": "First Name",
			  "displayToAgent": true,
			  "transcriptFields": ["First_Name__c"]
			}, {
			  "label": "Last Name",
			  "displayToAgent": true,
			  "transcriptFields": ["Last_Name__c"]
			}, {
			  "label": "Email",
			  "displayToAgent": true,
			  "transcriptFields": ["Email__c"]
			}, {
			  "label": "Subject",
			  "displayToAgent": true
			}
		];

		embedded_svc.settings.extraPrechatInfo = [
			{
				"entityName": "Contact",
				"showOnCreate": true,
				"linkToEntityName": "Case",
				"linkToEntityField": "ContactId",
				"entityFieldMaps" : [
					{
						"doCreate":true,
						"doFind":true,
						"fieldName":"Alkami_GUID__c",
						"isExactMatch" : true,
						"label":"Alkami GUID"
					}, {
						"doCreate": true,
						"doFind": true,
						"fieldName": "LastName",
						"isExactMatch": true,
						"label": "Last Name"
					}, {
						"doCreate": true,
						"doFind": true,
						"fieldName": "FirstName",
						"isExactMatch": true,
						"label": "First Name"
					}, {
						"doCreate": true,
						"doFind": true,
						"fieldName": "Email",
						"isExactMatch": true,
						"label": "Email"
					}
				]
			} ,{
				"entityName": "Case",
				"showOnCreate": true,
				"entityFieldMaps" : [
					{
						"doCreate" : true,
						"doFind" : false,
						"fieldName" : "Subject",
						"isExactMatch" : true,
						"label" : "Subject"
					}
				]
			}
		];
	}
</script>
